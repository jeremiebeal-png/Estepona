<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carte ‚Äî Services & Loisirs d‚ÄôEstepona</title>
  <meta name="description" content="Carte interactive des services utiles et loisirs √† Estepona." />
  <link rel="preload" href="styles.css" as="style" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üå¥</text></svg>">
  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous" />
  <style>
    /* Ajustements minimes compatibles avec la charte */
    #map { width:100%; height:560px; border-radius:16px; border:1px solid rgba(148,163,184,.15); box-shadow: var(--shadow); }
    .map-tools { display:flex; gap:10px; flex-wrap:wrap; margin:12px 0 16px }
    .legend { display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-top:10px; color:var(--muted) }
    .legend .item { display:flex; align-items:center; gap:8px }
    .legend .swatch { width:14px; height:14px; border-radius:3px; border:1px solid rgba(148,163,184,.35) }
    .leaflet-popup-content-wrapper{background:#0b1220;color:var(--text);border:1px solid rgba(148,163,184,.25)}
    .leaflet-popup-tip{background:#0b1220}
    body.light .leaflet-popup-content-wrapper, body.light .leaflet-popup-tip{ background:#ffffff; color:#0f172a; border-color: rgba(15,23,42,.15) }
  </style>
</head>
<body>
<header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="index.html">üå¥ Estepona en Fran√ßais</a>
    <button id="theme-toggle" class="btn" type="button">Mode clair</button>
    <button class="nav-toggle" aria-expanded="false" aria-controls="site-nav" aria-label="Ouvrir le menu">
      <span></span><span></span><span></span>
    </button>
    <nav id="site-nav" class="site-nav">
      <a href="index.html#decouvrir">D√©couvrir</a>
      <a href="index.html#plages">Plages & Chiringuitos</a>
      <a href="index.html#restaurants">Restaurants</a>
      <a href="index.html#installer">S‚Äôinstaller</a>
      <a href="index.html#blog">Blog</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </div>
</header>

<main>
  <section class="section">
    <div class="container">
      <a class="btn" href="index.html">‚Üê Retour √† l‚Äôaccueil</a>
      <header class="section-head" style="margin-top:12px">
        <h2>Services & Loisirs ‚Äî Carte interactive</h2>
        <p>Rep√®res utiles (mairie, police, h√¥pital, bus‚Ä¶) et lieux de loisirs (port, Orchidarium, chiringuitos‚Ä¶)</p>
      </header>

      <div class="map-tools" id="mapTools">
        <button class="btn primary" data-layer="services">Services</button>
        <button class="btn" data-layer="loisirs">Loisirs</button>
      </div>

      <div id="map" role="region" aria-label="Carte des services et loisirs d‚ÄôEstepona"></div>
      <div class="legend" id="legend"></div>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <p>¬© <span id="year"></span> Estepona en Fran√ßais ‚Äî Guide non officiel</p>
    <nav class="footer-nav">
      <a href="index.html#accueil">Haut de page</a>
      <a href="index.html#contact">Contact</a>
      <a href="#" rel="nofollow">Mentions l√©gales</a>
    </nav>
  </div>
</footer>

<script src="app.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>
<script>
(function(){
  // Carte centr√©e sur Estepona
  const map = L.map('map', {scrollWheelZoom:true}).setView([36.427, -5.147], 13.2);

  // Fond clair lisible (CARTO Voyager)
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap &copy; CARTO'
  }).addTo(map);

  // Calques
  const layers = {
    services: L.layerGroup().addTo(map),
    loisirs:  L.layerGroup().addTo(map)
  };

  // Ic√¥ne emoji
  const emIcon = (emoji) => L.divIcon({
    className:'', html:`<div style="font-size:20px;line-height:1.1">${emoji}</div>`,
    iconSize:[24,24], iconAnchor:[12,12]
  });

  // --- SERVICES (exemples que tu peux modifier/compl√©ter) ---
  const SERVICES = [
    {name:'Ayuntamiento (Mairie)', coords:[36.4269,-5.1470], icon:'üèõÔ∏è'},
    {name:'H√¥pital Cenyt / Urgences',    coords:[36.42803358238216, -5.138337439384645], icon:'üè•'},
    {name:'H√¥pital Hospiten / Urgences',    coords:[36.45279349006559, -5.083765066383493], icon:'üè•'},
    {name:'H√¥pital / Urgences',    coords:[36.4368,-5.1335], icon:'üè•'},
    {name:'Police Nationale',      coords:[36.432256578056794, -5.149475402679913], icon:'üëÆ'},
    {name:'Police Locale',         coords:[36.4175,-5.1691], icon:'üëÆ'},
    {name:'Office du Tourisme',    coords:[36.4238,-5.1469], icon:'‚ÑπÔ∏è'},
    {name:'Gare routi√®re (bus)',   coords:[36.4386,-5.1478], icon:'üöå'},
    {name:'Taxi',                  coords:[36.4246,-5.1485], icon:'üöï'},
    {name:'Pharmacie',             coords:[36.4255,-5.1480], icon:'üíä'},
    {name:'Pompiers',              coords:[36.4338,-5.1679], icon:'üöí'}
  ];

  SERVICES.forEach(s=>{
    L.marker(s.coords,{icon:emIcon(s.icon)}).addTo(layers.services)
      .bindPopup(`<b>${s.name}</b>`);
  });

  // --- LOISIRS (exemples) ---
  const LOISIRS = [
    {name:'Orchidarium',         coords:[36.4296,-5.1468], icon:'üå∫'},
    {name:'Port de Plaisance',   coords:[36.4202,-5.1593], icon:'‚õµ'},
    {name:'Chiringuito La Rada', coords:[36.4232,-5.1408], icon:'üçπ'},
    {name:'Plaza de las Flores', coords:[36.4254,-5.1486], icon:'üå∏'},
    {name:'Mus√©e Municipal',     coords:[36.4262,-5.1510], icon:'üèõÔ∏è'},
    {name:'Parc / Jardin',       coords:[36.4313,-5.1457], icon:'üå≥'}
  ];

  LOISIRS.forEach(l=>{
    L.marker(l.coords,{icon:emIcon(l.icon)}).addTo(layers.loisirs)
      .bindPopup(`<b>${l.name}</b>`);
  });

  // L√©gende
  const legend = document.getElementById('legend');
  legend.innerHTML = `
    <span class="item"><span class="swatch" style="background:#0ea5e9"></span>Services</span>
    <span class="item"><span class="swatch" style="background:#f59e0b"></span>Loisirs</span>
  `;

  // Filtres boutons
  document.getElementById('mapTools').addEventListener('click', (e)=>{
    const btn = e.target.closest('.btn'); if(!btn) return;
    document.querySelectorAll('.map-tools .btn').forEach(b=>b.classList.remove('primary'));
    btn.classList.add('primary');
    const id = btn.dataset.layer;
    const layer = layers[id];
    if(!layer) return;
    if(map.hasLayer(layer)) map.removeLayer(layer); else layer.addTo(map);
  });

  // Cadre
  map.fitBounds([[36.40,-5.20],[36.46,-5.10]]);
})();
</script>
</body>
</html>
