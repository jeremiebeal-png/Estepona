<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Carte ‚Äî Services & Loisirs d‚ÄôEstepona</title>
  <meta name="description" content="Carte interactive des services utiles et loisirs √† Estepona." />
  <link rel="preload" href="styles.css" as="style" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üå¥</text></svg>">
  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="anonymous" />
  <style>
    /* Ajustements compatibles avec la charte */
    #map { width:100%; height:560px; border-radius:16px; border:1px solid rgba(148,163,184,.15); box-shadow: var(--shadow); }
    .map-tools { display:flex; gap:10px; flex-wrap:wrap; margin:12px 0 16px }
    .legend { display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-top:10px; color:var(--muted) }
    .legend .item { display:flex; align-items:center; gap:8px }
    .legend .swatch { width:14px; height:14px; border-radius:3px; border:1px solid rgba(148,163,184,.35) }
    .leaflet-popup-content-wrapper{background:#0b1220;color:var(--text);border:1px solid rgba(148,163,184,.25)}
    .leaflet-popup-tip{background:#0b1220}
    body.light .leaflet-popup-content-wrapper, body.light .leaflet-popup-tip{ background:#ffffff; color:#0f172a; border-color: rgba(15,23,42,.15) }

    /* Panneau de liens utiles */
    .links-panel { margin-top:18px; }
    .card.links { padding:16px; }
    .links h3 { margin:0 0 8px }
    .links p { margin:0 0 10px; color:var(--muted) }
    .links .cols { display:grid; grid-template-columns:repeat(2,1fr); gap:12px }
    @media (max-width:760px){ .links .cols{ grid-template-columns:1fr } }
    .links ul{ margin:0; padding-left:18px }
    .links li + li{ margin-top:6px }
    .links a{ color:var(--primary, #2563eb); text-decoration:none }
    .links a:hover{ text-decoration:underline }
    .links .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px }
    .muted{ color:var(--muted) }
  </style>
</head>
<body>
<header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="index.html">üå¥ Estepona Jard√≠n de la Costa del Sol</a>
    <button id="theme-toggle" class="btn" type="button">Mode clair</button>
    <button class="nav-toggle" aria-expanded="false" aria-controls="site-nav" aria-label="Ouvrir le menu">
      <span></span><span></span><span></span>
    </button>
    <nav id="site-nav" class="site-nav">
      <a href="index.html#decouvrir">D√©couvrir</a>
      <a href="index.html#plages">Plages & Chiringuitos</a>
      <a href="index.html#restaurants">Restaurants</a>
      <a href="index.html#installer">S‚Äôinstaller</a>
      <a href="index.html#blog">Blog</a>
      <a href="index.html#contact">Contact</a>
    </nav>
  </div>
</header>

<main>
  <section class="section">
    <div class="container">
      <a class="btn" href="index.html">‚Üê Retour √† l‚Äôaccueil</a>
      <header class="section-head" style="margin-top:12px">
        <h2>Services & Loisirs ‚Äî Carte interactive</h2>
        <p>Rep√®res utiles (mairie, police, h√¥pital, bus‚Ä¶) et lieux de loisirs</p>
      </header>

      <div class="map-tools" id="mapTools">
        <button class="btn primary" data-layer="services">Services</button>
        <button class="btn" data-layer="loisirs">Loisirs</button>
      </div>

      <div id="map" role="region" aria-label="Carte des services et loisirs d‚ÄôEstepona"></div>
      <div class="legend" id="legend"></div>

      <!-- üîó Panneau de liens utiles (auto-g√©n√©r√© depuis les points avec "link") -->
      <div class="links-panel">
        <article class="card links">
          <h3>Liens utiles des lieux sur la carte</h3>
          <p class="muted">Cette liste se met √† jour automatiquement en fonction des points qui poss√®dent un site internet.</p>
          <div class="cols">
            <div>
              <strong>Services</strong>
              <ul id="links-services"></ul>
            </div>
            <div>
              <strong>Loisirs</strong>
              <ul id="links-loisirs"></ul>
            </div>
          </div>
          <div class="btns">
            <button id="copy-links" class="btn ghost">Copier tous les liens</button>
            <span id="copy-state" class="muted" aria-live="polite"></span>
          </div>
        </article>
      </div>
    </div>
  </section>
</main>

<footer class="site-footer">
  <div class="container footer-inner">
    <p>¬© <span id="year"></span> Estepona Jard√≠n de la Costa del Sol</p>
    <nav class="footer-nav">
      <a href="index.html#accueil">Haut de page</a>
      <a href="index.html#contact">Contact</a>
      <a href="#" rel="nofollow">Mentions l√©gales</a>
    </nav>
  </div>
</footer>

<script src="app.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin="anonymous"></script>
<script>
(function(){
  // Carte centr√©e sur Estepona
  const map = L.map('map', {scrollWheelZoom:true}).setView([36.427, -5.147], 13.2);

  // Fond clair lisible (CARTO Voyager)
  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap &copy; CARTO'
  }).addTo(map);

  // Calques
  const layers = {
    services: L.layerGroup().addTo(map),
    loisirs:  L.layerGroup().addTo(map)
  };

  // Ic√¥ne emoji
  const emIcon = (emoji) => L.divIcon({
    className:'', html:`<div style="font-size:20px;line-height:1.1">${emoji}</div>`,
    iconSize:[24,24], iconAnchor:[12,12]
  });

  // --- SERVICES (tu peux compl√©ter/ajuster) ---
  const SERVICES = [
    {name:'Ayuntamiento (Mairie)', coords:[36.424704587449064, -5.149520168244875], icon:'üèõÔ∏è', link:'https://ayuntamiento.estepona.es/'},
    {name:'H√¥pital / Urgences',    coords:[36.4368,-5.1335], icon:'üè•', link:'https://www.hospitallacostadelsol.es/'},
    {name:'H√¥pital Cenyt / Urgences', coords:[36.42803358238216, -5.138337439384645], icon:'üè•', link:'https://cenythospital.com/'},
    {name:'H√¥pital Hospiten',      coords:[36.45279349006559, -5.083765066383493], icon:'üè•', link:'https://www.hospiten.com/'},
    {name:'Police Nationale',      coords:[36.432256578056794, -5.149475402679913], icon:'üëÆ'},
    {name:'Police Locale',         coords:[36.4175,-5.1691], icon:'üëÆ'},
    {name:'Office du Tourisme',    coords:[36.42598683672326, -5.145477049783284], icon:'‚ÑπÔ∏è', link:'https://turismo.estepona.es/'},
    {name:'Gare routi√®re (bus)',   coords:[36.43036021569422, -5.127477488845281], icon:'üöå', link:'https://www.avanzabus.com/'},
    {name:'Pompiers',              coords:[36.432248863354, -5.161996617595514], icon:'üöí'}
  ];

  SERVICES.forEach(s=>{
    let html = `<b>${s.name}</b>`;
    if(s.link){
      html += `<br><a href="${s.link}" target="_blank" rel="noopener">Voir le site</a>`;
    }
    L.marker(s.coords,{icon:emIcon(s.icon)}).addTo(layers.services).bindPopup(html);
  });

  // --- LOISIRS (tu peux compl√©ter/ajuster) ---
  const LOISIRS = [
    {name:'Orchidarium',         coords:[36.4296,-5.1468], icon:'üå∫', link:'https://turismo.estepona.es/visitel-orchidarium/'},
    {name:'Port de Plaisance',   coords:[36.4202,-5.1593], icon:'‚õµ'},
    {name:'Chiringuito La Rada', coords:[36.4232,-5.1408], icon:'üçπ'},
    {name:'Plaza de las Flores', coords:[36.4254,-5.1486], icon:'üå∏'},
    {name:'Mus√©e Municipal',     coords:[36.4262,-5.1510], icon:'üèõÔ∏è'},
    {name:'Parc / Jardin',       coords:[36.4313,-5.1457], icon:'üå≥'}
  ];

  LOISIRS.forEach(l=>{
    let html = `<b>${l.name}</b>`;
    if(l.link){
      html += `<br><a href="${l.link}" target="_blank" rel="noopener">Voir le site</a>`;
    }
    L.marker(l.coords,{icon:emIcon(l.icon)}).addTo(layers.loisirs).bindPopup(html);
  });

  // L√©gende
  const legend = document.getElementById('legend');
  legend.innerHTML = `
    <span class="item"><span class="swatch" style="background:#0ea5e9"></span>Services</span>
    <span class="item"><span class="swatch" style="background:#f59e0b"></span>Loisirs</span>
  `;

  // Filtres boutons
  document.getElementById('mapTools').addEventListener('click', (e)=>{
    const btn = e.target.closest('.btn'); if(!btn) return;
    btn.classList.toggle('primary'); // on/off
    const id = btn.dataset.layer;
    const layer = layers[id];
    if(!layer) return;
    if(map.hasLayer(layer)) map.removeLayer(layer); else layer.addTo(map);
  });

  // Cadre
  map.fitBounds([[36.40,-5.20],[36.46,-5.10]]);

  // ======= G√©n√©ration auto du panneau de liens =======
  function renderLinks(){
    const sUL = document.getElementById('links-services');
    const lUL = document.getElementById('links-loisirs');
    sUL.innerHTML = '';
    lUL.innerHTML = '';

    const sLinks = SERVICES.filter(x=>x.link).map(x=>({name:x.name, link:x.link}));
    const lLinks = LOISIRS.filter(x=>x.link).map(x=>({name:x.name, link:x.link}));

    if(sLinks.length===0) sUL.innerHTML = '<li class="muted">Aucun lien renseign√© pour les services.</li>';
    if(lLinks.length===0) lUL.innerHTML = '<li class="muted">Aucun lien renseign√© pour les loisirs.</li>';

    sLinks.forEach(item=>{
      const li = document.createElement('li');
      li.innerHTML = `<a href="${item.link}" target="_blank" rel="noopener">${item.name}</a>`;
      sUL.appendChild(li);
    });
    lLinks.forEach(item=>{
      const li = document.createElement('li');
      li.innerHTML = `<a href="${item.link}" target="_blank" rel="noopener">${item.name}</a>`;
      lUL.appendChild(li);
    });
  }
  renderLinks();

  // Copier tous les liens
  document.getElementById('copy-links').addEventListener('click', async ()=>{
    const links = [
      ...SERVICES.filter(x=>x.link).map(x=>`${x.name}: ${x.link}`),
      ...LOISIRS.filter(x=>x.link).map(x=>`${x.name}: ${x.link}`)
    ].join('\n');
    try{
      await navigator.clipboard.writeText(links || 'Aucun lien disponible.');
      document.getElementById('copy-state').textContent = 'Liens copi√©s dans le presse‚Äëpapiers ‚úÖ';
      setTimeout(()=>document.getElementById('copy-state').textContent='', 3000);
    }catch(e){
      document.getElementById('copy-state').textContent = 'Impossible de copier (droits navigateur).';
    }
  });
})();
</script>
</body>
</html>
